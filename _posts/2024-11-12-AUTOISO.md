---
title: Auto Iso Downloader
date: 2024-11-12 23:03:00 +/-0100
categories: [Windows, Scripting]
tags: [powershell, OS]    
author: <author_id>
description: Simple, rapide, efficace, un max de distro linux (plus encore bientot) en 1 script 
comments: false
---

# Downloader Automatique d'images ISO 
### On va l'appeler `DAI`, c'est plus clair et plus rapide a dire.

Alors qu'est-ce que DAI ?
Vous l'avez peut etre lu sur ma [page a propos](https://laykon4.github.io/about/) mais je suis etudiant et 80% de mon travail est fait sur machine virtuelle et je dois souvent DL de nouvelle version d'iso au vu du nombres de distro linux et des MaJ qu'ils font.

Et ca ma un peu saoulé d'aller regarder toutes les deux semaines sur chaque distro que j'ai creer **DAI**.

<br><br>

# Comment ca marche ?
Alors en premier lieu j'ai fais une doc en anglais juste ici : [Documentation](https://github.com/Laykon4/Iso-Auto-Downloader)

<br>

Mais je vais quand meme expliquer en francais ici.
<br>

> Avant d'executer le script assurer vous de remplir les prerequis dispo sur le fichier `readme` de Github.
{: .prompt-info }

Avant toute chose ondefinit 2 varaible qui vont definir ou seront stockés tout les dossier et images ISO
```powershell
$folderName = "IsoAD"
$desktopPath = "$env:USERPROFILE\desktop\$folderName"
```

Ensuite on verifie si le dossier existe deja. 
```powershell
if (Test-Path -Path $desktopPath) {
    Write-Host "The folder '$folderName' already exists on the desktop." -ForegroundColor Yellow
} else {
    Write-Host "The folder '$folderName' does not exist. Creating it now..." -ForegroundColor Green
    New-Item -ItemType Directory -Path $desktopPath
    Write-Host "The folder '$folderName' has been created at: $folderPath" -ForegroundColor Cyan
}
```

### Rentrons dans le vif du sujet :

Premiere etape : <br> Le script contient une fonction pour chaque OS/Distro avec son nom, l'url des releases, le chemin d'installation local et le pattern du nom du fichier en utilisant regex.

```powershell
    $distro = "Debian" # Name of final directory in IsoAD
    $debianUrl = "https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/"
    $debianIsoPattern = "debian-[\d.]+-amd64-netinst\.iso"
    $debianLocalPath = "$env:USERPROFILE\desktop\$folderName\$distro\"
    $sha256LocalPath = "$env:USERPROFILE\desktop\$folderName\$distro\"
    $sha256Url = "https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/SHA256SUMS"
```
> Certaines distro peuvent avoir different formats en fonction de leur specificites
{: .prompt-info }
<br>
Ensuite le script essaie de faire correspondre le pattern avec le contenu de la page etregarde quel fichier est le plus recentm si le fichier n'existe pas localement ou que il y a plus recent que le local, le script va alors le telecharger. une fois fait il compares les valeur de hash pour ajouter une couche de sureté.

```powershell
Write-Host "You selected Debian. Proceeding with Debian setup..."
    $response = Invoke-WebRequest -Uri $debianUrl
    $pageContent = $response.Content

    $isoFile = [regex]::Match($pageContent, $debianIsoPattern).Value

    if ($isoFile) {
        $latestIsoUrl = "$debianUrl$isoFile"
        $localPath = "$debianLocalPath$isoFile"

        if (Test-Path -Path $localPath) {
            $localLastModified = (Get-Item -Path $localPath).LastWriteTime

            $remoteLastModified = $response.Headers["Last-Modified"]
            $remoteLastModifiedDate = [DateTime]::ParseExact($remoteLastModified, "R", $null)

            if ($remoteLastModifiedDate -gt $localLastModified) {
                Invoke-WebRequest -Uri $latestIsoUrl -OutFile $localPath
                Invoke-WebRequest -Uri $sha256Url -OutFile $sha256LocalPath

                $calcSha256 = (Get-FileHash -Path $latestIsoUrl -Algorithm SHA256).Hash
                $expectedSha256 = Select-String -Path $sha256LocalPath -Pattern ([System.IO.Path]::GetFileName($latestIsoUrl)) | ForEach-Object { $_ -replace "\s.*", "" }
                if ($calcSha256 -eq $expectedSha256) {
                    Write-Host "The file is valid :" -NoNewline
                    Write-Host " SHA-256 hash matches." -ForegroundColor Green
                } else {
                    Write-Host "The file is corrupted or modified :" -NoNewline
                    Write-Host " SHA-256 hash does not match." -ForegroundColor Red
                }
            
                Write-Host "Debian : The new files were downloaded :" -NoNewline
                Write-Host " $isoFile | $sha256url" -ForegroundColor Green
            } else {
                Write-Host "Debian : The iso and sha256 file are already up to date."
            }
        } 
        else {
            Invoke-WebRequest -Uri $latestIsoUrl -OutFile $localPath
            Invoke-WebRequest -Uri $sha256Url -OutFile $sha256LocalPath

            Write-Host "Debian : The ISO and sha256 file did not exist locally and was downloaded :" -NoNewline
            Write-Host " $isoFile | $sha256url" -ForegroundColor Green

            if ($calcSha256 -eq $expectedSha256) {
                Write-Host "The file is valid :" -NoNewline
                Write-Host " SHA-256 hash matches." -ForegroundColor Green
            } else {
                Write-Host "The file is corrupted or modified :" -NoNewline
                Write-Host " SHA-256 hash does not match." -ForegroundColor Red
            }
        }
```
> Le code peut varier selon les distro
{: .prompt-info }

<br>
Si rien ne match, il affichera un message d'erreur.

```powershell
else {
  Write-Host "Debian : No ISO files found in the directory." -ForegroundColor Red
}
```
---
<br><br>


# Choosing OS
### Actuellement il y a 5 Distros disponibles
<br>

Alors comment choisir quel OS veut t'on ?
```powershell
$choice = Read-Host "Choose an OS type : `n 1 - Debian `n 2 - Kali Linux `n 3 - Ubuntu `n 4 - Arch Linux `n 5 - Linux Mint `n 99 - Download all `n Your choice "


$osType = switch ($choice) {
    "1" { debian }
    "2" { kaliLinux }
    "3" { ubuntu }
    "4" { archLinux }
    "5" { linuxMint }
    "99" {dlAll}
    Default { "Unknown" }
}
```

`"99" {dlAll}` cherche et DL tout si besoin
